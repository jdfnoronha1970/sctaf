unit ucadresultado;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.DBCtrls, Vcl.Buttons,
  PngSpeedButton, PngBitBtn, Vcl.ToolWin, Vcl.ComCtrls, Vcl.Mask;

type
  TFcadresultados = class(TForm)
    DBLookupComboBox1: TDBLookupComboBox;
    Label1: TLabel;
    ToolBar1: TToolBar;
    PngBitBtn1: TPngBitBtn;
    PngSpeedButton1: TPngSpeedButton;
    PngBitBtn3: TPngBitBtn;
    PngBitBtn2: TPngBitBtn;
    Label2: TLabel;
    DBLookupComboBox3: TDBLookupComboBox;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    DBEdit1: TDBEdit;
    DBEdit2: TDBEdit;
    DBEdit3: TDBEdit;
    DBEdit4: TDBEdit;
    DBEdit5: TDBEdit;
    Label9: TLabel;
    DBEdit6: TDBEdit;
    DBLookupComboBox4: TDBLookupComboBox;
    Label10: TLabel;
    Label11: TLabel;
    Label12: TLabel;
    DBLookupComboBox5: TDBLookupComboBox;
    DBLookupComboBox2: TDBLookupComboBox;
    Edit1: TEdit;
    Edit2: TEdit;
    Edit3: TEdit;
    procedure PngBitBtn2Click(Sender: TObject);
    procedure PngBitBtn1Click(Sender: TObject);
    procedure PngSpeedButton1Click(Sender: TObject);
    procedure PngBitBtn3Click(Sender: TObject);
    procedure DBLookupComboBox1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Fcadresultados:                     TFcadresultados;
//  pesqdn:         integer;
  pesqdn:                             TdateTime;
  idade:                              integer;
  anoAtual:                           TdateTime;
  anoi, anof, mesi, mesf, diai, diaf: word;

implementation

{$R *.dfm}
uses
udados;


procedure TFcadresultados.DBLookupComboBox1Click(Sender: TObject);
begin
  anoAtual:= now();
  pesqdn:= dados.qmildn.AsDateTime;
  edit1.Text:= datetostr(pesqdn);
  decodedate(pesqdn, anoi,mesi,diai);
  decodedate(anoAtual, anof, mesf, diaf);

  idade:= anof-anoi;
  edit2.Text:= inttostr(idade);


      with dados.qfaixaidade do
        begin
          close;
          sql.Clear;
          sql.Add('elect cod from tbfaixaetaria where :pcodidade BETWEEN min AND max');
          params.ParamValues('codidade'):= idade;
          open;
        end;

        edit3.Text:= dados.qfaixaidade.FieldByName('cod').AsString;
end;

procedure TFcadresultados.PngBitBtn1Click(Sender: TObject);
begin
  try
    begin
      dados.Tresutados.Active:= true;
      dados.dresultados.Enabled:= true;
      dados.qmil.Active:= true;
      dados.dqmil.Enabled:= true;
      dados.qord.Active:= true;
      dados.dqord.Enabled:= true;
      dados.qchamada.Active:= true;
      dados.dqchamada.Enabled:= true;
      dados.Tsu.Active:= true;
      dados.Dsu.Enabled:= true;
      dados.Tresutados.Append;
      dados.qpd.Active:= true;
      dados.dqpd.Enabled:= true;
     // Dbedit6.Field.Value:= ((formatDateTime('YYYY', date())));
      dados.Tresutados.Append;
      DBLookupComboBox5.KeyValue := 2;
      dblookupCombobox1.SetFocus;
    end;
  except
    begin
      showmessage('Operação Inválida');
      PngBitBtn1.SetFocus;
    end;
  end;
end;

procedure TFcadresultados.PngBitBtn2Click(Sender: TObject);
begin
  close;
end;

procedure TFcadresultados.PngBitBtn3Click(Sender: TObject);
begin
  try
    begin
      if (DBLookupComboBox1.Field.AsString='') then
      begin
      showmessage('Há campo vazios, favor verifica');
      dados.Tresutados.Cancel;
      PngBitBtn1.SetFocus;
      end;

      dados.Tresutados.Post;
      showmessage('Cadastro efetuado');
      dados.Tresutados.Close;
      PngBitBtn1.SetFocus;
    end;
  except
    begin
      showmessage('Operação inválida');
      PngBitBtn1.SetFocus;;
    end;
  end
end;

procedure TFcadresultados.PngSpeedButton1Click(Sender: TObject);
begin
  try
    begin
      dados.Tresutados.Cancel;
      PngBitBtn1.SetFocus;
      dbedit1.SetFocus;
    end;
  except
    begin
      showmessage('Operação Inválida');
      PngBitBtn1.SetFocus;
    end;
  end;
end;

end.
